<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://place1.dev/main.css">
    <title>Blog</title>
</head>
<body>
    <h1 class="text-center">Blog</h1>

    <ul id="posts">

    </ul>

    <script type="module">

        import YAML from 'https://cdn.jsdelivr.net/npm/yaml@2.7/browser/index.js'
        window.YAML = YAML

        function extractFrontMatter(content) {
            const match = content.match(/^---\n([\s\S]*?)\n---\n([\s\S]*)/);
            if (!match) {
                return { frontMatter: null, body: content.trim() };
            }

            return {
                frontMatter: YAML.parse(match[1]),
                body: match[2].trim()
            };
        }

        fetch("https://api.github.com/repos/digitalisdizzy/blog-test/git/trees/main?recursive=1").then(r => r.json().then(data => {
            const posts = data.tree.filter(item => !item.path.includes("/") && item.path.endsWith(".md"))

            posts.forEach(item => {
                fetch(`https://raw.githubusercontent.com/digitalisdizzy/blog-test/refs/heads/main/${item.path}`).then(r2 => r2.text().then(raw => {
                    const post = extractFrontMatter(raw)
                    const el = `<li><a href="/blog-test/${item.path.split(".")[0]}">${post.frontMatter.title || item.path.split(".")[0]}</a></li>\n`
                    document.getElementById("posts").innerHTML += el
                }))
            });
        })).catch(console.error)
    </script>
</body>
</html>